# دليل رفع البيانات إلى Supabase

## نظرة عامة
تم إنشاء نظام شامل لرفع جميع البيانات والملفات المحلية إلى Supabase كنسخة احتياطية سحابية.

## البيانات المتوفرة للرفع

### 1. المعاملات المالية
- **العدد**: 561 معاملة
- **البيانات**: التاريخ، النوع، المبلغ، الوصف، المشروع المرتبط
- **المرفقات**: 9 ملفات مرتبطة بالمعاملات

### 2. الملفات المرفقة
- **المجلد**: `./uploads/`
- **الأنواع**: PDF, JPG, PNG
- **التنظيم**: ملفات منظمة حسب معرف المعاملة

### 3. البيانات الإضافية
- المشاريع (5 مشاريع)
- المستخدمين (6 مستخدمين)
- أنواع المصروفات (18 نوع)
- الموظفين (1 موظف)

## آلية الرفع

### الطريقة الأولى: API Endpoints
```bash
# فحص حالة المزامنة
GET /api/supabase/sync-status

# تنفيذ الرفع
POST /api/supabase/migrate
```

### الطريقة الثانية: Script مباشر
```bash
npx tsx scripts/upload-to-supabase.ts
```

## خصائص النظام

### 1. رفع الملفات
- رفع تلقائي إلى Supabase Storage
- إنشاء روابط عامة للملفات
- تحديث روابط الملفات في قاعدة البيانات
- حفظ البيانات الوصفية (نوع الملف، الحجم)

### 2. مزامنة البيانات
- رفع بدفعات لتجنب قيود الخدمة
- استخدام upsert لتجنب التكرار
- مزامنة جميع الجداول الأساسية

### 3. مراقبة العملية
- تقارير مفصلة للتقدم
- إحصائيات النجاح والفشل
- تسجيل تفصيلي للأخطاء

## التكوين المطلوب

### متغيرات البيئة
```env
DATABASE_URL=postgresql://...
SUPABASE_URL=https://bvlmyzdcfqjwrskakfxk.supabase.co
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### إعداد Supabase
1. إنشاء bucket للملفات باسم `files`
2. تفعيل الوصول العام للملفات
3. إنشاء الجداول المطلوبة

## النتائج المتوقعة

بعد تنفيذ الرفع بنجاح:
- **561 معاملة** مرفوعة إلى Supabase
- **9 ملفات** مرفوعة إلى Storage
- **جميع البيانات الإضافية** متزامنة
- **نسخة احتياطية كاملة** جاهزة في السحابة

## استكشاف الأخطاء

### مشاكل شائعة:
1. **انتهاء صلاحية المفاتيح**: تحديث SUPABASE_ANON_KEY
2. **حدود الحجم**: تقسيم الملفات الكبيرة
3. **قيود الشبكة**: إعادة المحاولة التلقائية

### الحلول:
- فحص الاتصال بـ Supabase
- التحقق من صلاحيات Storage
- مراجعة سجلات الأخطاء